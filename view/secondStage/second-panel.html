<div class="panel panel-default">
    <div class="panel-heading text-center"><b>Etap 2 - Łączenie Gorących Miejsc i znalezienie najlepszych Ciagów Diagonalnych</b></div>

    <div fasta-sequences-at-stage sequences="stepData.baseSequences"></div>

    <div ng-show="stepData.bestSequences">
        Sekwencje wybrane do następnego etapu na podstawie najlepszych ciągów diagonalnych:
        <ul>
            <li ng-repeat="sequence in stepData.bestSequences">{{::sequence}}</li>
        </ul>
    </div>

    <div class="panel-body">
        <div class="">
            <table id="scoring-matrix">
                <thead>
                <tr class="success">
                    <th></th>
                    <th ng-repeat="(symbol, values) in stepData.scoreMatrix track by $index">{{::symbol}}</th>
                </tr>
                </thead>
                <tbody>
                <tr ng-repeat="(symbol, values) in stepData.scoreMatrix track by $index">
                    <td class="col-md-1"> <label>{{::symbol}}</label> </td>
                    <td class="" ng-repeat="(key, scoreValue) in values track by $index" data-container="body">
                        <input type="number" class="form-control text-center" ng-model="::stepData.scoreMatrix[symbol][key]">
                    </td>
                </tr>
                </tbody>
            </table>
        </div>
        <label>Maksymalna odległość pomiędzy Gorącymi Miejscami:</label>
        <input type="number">

        <div fasta-sequences-tabs sequences="stepData.baseSequences" change-sequence="changeSequence(index)"></div>

        <div>
            <label>Lista<span ng-if="stepData.foundBestStep"> 10 najlepszych</span> znalezionych Ciągów Diagonalnych:</label>
            <span>(kliknij na ciąg, aby go podświetlić w tabeli)</span>

            <p>Base Sequence: <span ng-bind=stepData.currentBaseSequence id="baseSequence-p"></span></p>

            <p>Query Sequence: <span id="querySequence-p"> {{::stepData.querySequence}}</span></p>
            <ul>
                <li ng-repeat="diagonal in stepData.currentDiagonals[stepData.currentBaseSequence]" class="highlight-on-hover" fasta-highlight
                    highlight-paragraphs-list="::[{paragraphId: 'baseSequence-p', content: stepData.currentBaseSequence,
                     startIndex: diagonal.startPoint[0], length: (diagonal.endPoint[0] - diagonal.startPoint[0]) + 1},
                     {paragraphId: 'querySequence-p', content: stepData.querySequence, startIndex: diagonal.startPoint[1], length: (diagonal.endPoint[1] - diagonal.startPoint[1]) + 1}]">
                    <a class="diagonal-link" ng-click="highlightOnDiagonalsTable(diagonal)" ng-class="{'highlight-on-click-text' : (stepData.selectedDiagonal == diagonal)}">
                        Base Sequence: [{{::diagonal.startPoint[0]}}, {{::diagonal.endPoint[0]}}] -
                        {{::stepData.currentBaseSequence | limitTo : (diagonal.endPoint[0] - diagonal.startPoint[0]) + 1 :
                        diagonal.startPoint[0]}},
                        Query Sequence: [{{::diagonal.startPoint[1]}}, {{::diagonal.endPoint[1]}}] -
                        {{::stepData.querySequence | limitTo : (diagonal.endPoint[1] - diagonal.startPoint[1]) + 1 :
                        diagonal.startPoint[1]}}<span ng-show="diagonal.score !== undefined">, Diagonal Score: {{diagonal.score}}</span>
                    </a>
                </li>
            </ul>
        </div>

        <div class="container-overflow">
            <div fasta-diagonals-table></div>
        </div>
    </div>
</div>

<div fasta-navigation-footer previous-url="/first_stage" next-url="/third_stage" last-step="stepData.lastStep"
     save-step="saveLastStep(lastStep)" config="stepData.stepByStepConfig"></div>
